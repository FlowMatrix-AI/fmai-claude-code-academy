---
phase: 01-content-foundation-navigation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/lib/content/loader.ts
  - src/lib/navigation/structure.ts
  - src/lib/navigation/paths.ts
  - src/app/page.tsx
  - src/app/modules/[moduleId]/page.tsx
  - src/app/modules/[moduleId]/[lessonId]/page.tsx
  - src/components/content/MarkdownRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "User can view any lesson by navigating to /modules/{moduleId}/{lessonId}"
    - "Lesson content renders with correct formatting including code blocks, tables, and headings"
    - "All pages are statically generated at build time (no runtime content fetching)"
    - "Landing page shows course overview with links to all modules"
    - "Module overview page lists all lessons in that module"
  artifacts:
    - path: "src/lib/content/loader.ts"
      provides: "Content loading functions (getLesson, getAllLessonPaths, getCourseStructure, getModule)"
      exports: ["getLesson", "getAllLessonPaths", "getCourseStructure", "getModule"]
    - path: "src/lib/navigation/structure.ts"
      provides: "Course structure utilities and flattened lesson ordering for prev/next navigation"
      exports: ["getCourseStructure", "getFlatLessonList", "getAdjacentLessons"]
    - path: "src/lib/navigation/paths.ts"
      provides: "Route path utilities for generating lesson and module URLs"
      exports: ["getLessonPath", "getModulePath"]
    - path: "src/app/modules/[moduleId]/[lessonId]/page.tsx"
      provides: "Lesson page with generateStaticParams for SSG"
      exports: ["default", "generateStaticParams", "generateMetadata"]
    - path: "src/app/modules/[moduleId]/page.tsx"
      provides: "Module overview page listing lessons"
      exports: ["default", "generateStaticParams", "generateMetadata"]
    - path: "src/components/content/MarkdownRenderer.tsx"
      provides: "Component that renders pre-sanitized HTML content safely"
  key_links:
    - from: "src/lib/content/loader.ts"
      to: "src/lib/content/parser.ts"
      via: "import parseMarkdown"
      pattern: "import.*parseMarkdown.*from.*parser"
    - from: "src/lib/content/loader.ts"
      to: "content/meta.json"
      via: "fs.readFile for course structure"
      pattern: "readFile.*meta\\.json"
    - from: "src/app/modules/[moduleId]/[lessonId]/page.tsx"
      to: "src/lib/content/loader.ts"
      via: "import getLesson, getAllLessonPaths"
      pattern: "import.*getLesson.*from.*loader"
    - from: "src/app/page.tsx"
      to: "src/lib/navigation/structure.ts"
      via: "import getCourseStructure"
      pattern: "import.*getCourseStructure.*from.*structure"
---

<objective>
Build the content loading layer, navigation utilities, and all page routes so users can view any lesson at its URL with properly rendered content.

Purpose: Connects the content pipeline (Plan 01) to actual web pages. After this plan, every lesson in the course is viewable as a statically generated page with formatted content.

Output: Content loader that reads and parses markdown files, navigation utilities for lesson ordering, lesson/module/landing pages using Next.js static generation, and a MarkdownRenderer component.
</objective>

<execution_context>
@/Users/dominicjoseph/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dominicjoseph/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-content-foundation-navigation/01-RESEARCH.md
@.planning/phases/01-content-foundation-navigation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Content loader, navigation utilities, and MarkdownRenderer component</name>
  <files>
    src/lib/content/loader.ts
    src/lib/navigation/structure.ts
    src/lib/navigation/paths.ts
    src/components/content/MarkdownRenderer.tsx
  </files>
  <action>
1. Create `src/lib/content/loader.ts`:
   - Import `parseMarkdown` from parser.ts, `matter` from gray-matter, types from types.ts
   - `CONTENT_DIR = path.join(process.cwd(), 'content')`
   - Export `getCourseStructure(): Promise<CourseStructure>` -- reads and parses content/meta.json
   - Export `getLesson(moduleId: string, lessonId: string): Promise<Lesson>` -- reads the markdown file at `content/{moduleId}/{lessonId}.md`, extracts frontmatter with gray-matter, parses body with parseMarkdown, resolves previous/next lesson links using navigation structure, returns complete Lesson object
   - Export `getModule(moduleId: string): Promise<ModuleMeta>` -- returns module metadata from meta.json
   - Export `getAllLessonPaths(): Promise<Array<{ moduleId: string; lessonId: string }>>` -- returns all lesson path combinations for generateStaticParams
   - Export `getAllModuleIds(): Promise<string[]>` -- returns all module IDs for generateStaticParams

2. Create `src/lib/navigation/structure.ts`:
   - Export `getFlatLessonList(structure: CourseStructure): LessonNavLink[]` -- flattens the nested module/lesson structure into a single ordered list for prev/next navigation. Order: modules by module.order, within each module lessons by lesson.order.
   - Export `getAdjacentLessons(structure: CourseStructure, moduleId: string, lessonId: string): { previous: LessonNavLink | null; next: LessonNavLink | null }` -- finds current lesson in flat list, returns previous and next entries (null at boundaries).

3. Create `src/lib/navigation/paths.ts`:
   - Export `getLessonPath(moduleId: string, lessonId: string): string` -- returns `/modules/${moduleId}/${lessonId}`
   - Export `getModulePath(moduleId: string): string` -- returns `/modules/${moduleId}`

4. Create `src/components/content/MarkdownRenderer.tsx`:
   - Accept prop `htmlContent: string`
   - SECURITY NOTE: The htmlContent has already been sanitized via isomorphic-dompurify in the parser pipeline (CONT-05). The MarkdownRenderer receives pre-sanitized HTML from build-time processing. Use React's innerHTML rendering to display it.
   - Wrap in a div with className "prose prose-slate dark:prose-invert max-w-none" for Tailwind Typography styling
   - Install @tailwindcss/typography: `npm install @tailwindcss/typography` and add to Tailwind config if needed
   - Add custom CSS classes for code blocks (overflow-x-auto) and Obsidian callout styling
   - This is a Server Component (no 'use client' directive needed)
  </action>
  <verify>
    Run `npx tsc --noEmit` -- no TypeScript errors.
    Write a quick script that calls `getLesson('architecture', 'overview')` and logs the result. Verify it returns a Lesson object with non-empty htmlContent, correct title, and previous/next links.
    Write a script that calls `getAllLessonPaths()` and verify it returns 16 entries.
  </verify>
  <done>
    Content loader reads markdown files and returns parsed Lesson objects. Navigation utilities compute previous/next links across module boundaries. Path utilities generate consistent URLs. MarkdownRenderer component renders pre-sanitized HTML with prose styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create all page routes with static generation</name>
  <files>
    src/app/page.tsx
    src/app/modules/[moduleId]/page.tsx
    src/app/modules/[moduleId]/[lessonId]/page.tsx
  </files>
  <action>
1. Update `src/app/page.tsx` (landing page):
   - Server Component (no 'use client')
   - Import getCourseStructure from loader.ts
   - Display course title ("FMAI Claude Code Academy") and description
   - List all modules as cards using shadcn/ui Card component, each showing:
     - Module title
     - Module description
     - Lesson count (e.g., "6 lessons")
     - Link to `/modules/{moduleId}` (first lesson or module overview)
   - Include a brief intro paragraph explaining the course purpose (from PROJECT.md core value: "learn the full FMAI Claude Code system well enough to use it independently and teach others")
   - Style with Tailwind: centered container, responsive grid (1 col on mobile, 2 on md, 3 on lg)

2. Create `src/app/modules/[moduleId]/page.tsx` (module overview):
   - Server Component with `generateStaticParams` returning all module IDs
   - Import getModule and getCourseStructure from loader.ts
   - Display module title and description
   - List all lessons in the module as clickable links with lesson order numbers
   - Each lesson links to `/modules/{moduleId}/{lessonId}`
   - Include `generateMetadata` for SEO (title: "{Module Title} | FMAI Claude Code Academy")
   - Handle 404: if moduleId not found, call `notFound()` from next/navigation

3. Create `src/app/modules/[moduleId]/[lessonId]/page.tsx` (lesson page):
   - Server Component with `generateStaticParams` returning all moduleId/lessonId combinations
   - Import getLesson, getAllLessonPaths from loader.ts
   - Import MarkdownRenderer from components
   - Display lesson title as h1
   - Render lesson content via MarkdownRenderer
   - Display version metadata at bottom of lesson: "Content version: {systemVersion} | Last verified: {lastVerified}" (CONT-06)
   - Include `generateMetadata` for SEO
   - Handle 404: if lesson not found, call `notFound()`
   - NOTE: Do NOT add navigation components (sidebar, breadcrumbs, prev/next) yet -- those come in Plan 03. Just render the content.

4. Run `npm run build` to verify static generation works:
   - Build should output all pages as static HTML
   - All 16 lesson pages + 7 module pages + 1 landing page = 24 pages generated
   - No build errors or warnings about missing content

5. Run `npm run dev` and manually verify:
   - http://localhost:3000 shows landing page with 7 module cards
   - Clicking a module shows its lesson list
   - Clicking a lesson shows rendered markdown content
   - Code blocks have syntax highlighting
   - Tables render correctly
   - Wikilinks are clickable and link to correct /modules/ paths
  </action>
  <verify>
    Run `npm run build` -- must succeed. Check build output for number of static pages generated (should show 24+ routes).
    Run `npm run dev` and curl http://localhost:3000 -- should contain "FMAI Claude Code Academy".
    Curl http://localhost:3000/modules/architecture/overview -- should contain rendered HTML with code blocks.
    Curl http://localhost:3000/modules/agents/gsd-pipeline -- should contain rendered lesson content.
    Verify wikilinks in content are rendered as anchor tags pointing to /modules/ routes (not raw bracket syntax).
  </verify>
  <done>
    Landing page displays 7 module cards. Module pages list their lessons. Lesson pages render full Obsidian markdown content with syntax highlighting, tables, and resolved wikilinks. All pages are statically generated at build time. Version metadata displayed on lesson pages (CONT-06). 404 handling works for invalid routes.
  </done>
</task>

</tasks>

<verification>
- `npm run build` generates 24+ static pages with no errors
- Landing page shows all 7 modules with descriptions and lesson counts
- Every lesson URL (/modules/{moduleId}/{lessonId}) renders formatted content
- Code blocks display with syntax highlighting
- Wikilinks resolve to correct internal routes
- Version metadata visible on lesson pages
- Module overview pages list all lessons with working links
</verification>

<success_criteria>
1. All 16 lessons viewable at their URLs with properly rendered content
2. All 7 modules have overview pages listing their lessons
3. Landing page provides entry point to all course content
4. Static generation produces all pages at build time (CONT-04)
5. Version metadata displayed on every lesson (CONT-06)
6. Build completes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/01-content-foundation-navigation/01-02-SUMMARY.md`
</output>

---
phase: 01-content-foundation-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.mjs
  - tailwind.config.ts
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
  - src/lib/content/types.ts
  - src/lib/content/parser.ts
  - src/lib/content/sanitizer.ts
  - src/lib/content/obsidian.ts
  - content/meta.json
  - content/**/*.md
autonomous: true

must_haves:
  truths:
    - "Next.js 15 app builds and runs with `npm run dev`"
    - "All FMAI Knowledge Base markdown content exists in content/ directory with frontmatter"
    - "Markdown parser converts Obsidian markdown to sanitized HTML including wikilinks, callouts, GFM tables, and syntax-highlighted code blocks"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies (Next.js 15, remark/rehype pipeline, Obsidian plugins, shadcn/ui, isomorphic-dompurify)"
    - path: "src/lib/content/types.ts"
      provides: "TypeScript interfaces for Lesson, Module, CourseStructure, LessonMetadata"
    - path: "src/lib/content/parser.ts"
      provides: "Markdown-to-HTML pipeline with remark/rehype, Obsidian wikilink + callout support, syntax highlighting"
      exports: ["parseMarkdown"]
    - path: "src/lib/content/sanitizer.ts"
      provides: "DOMPurify HTML sanitization wrapper"
      exports: ["sanitizeHTML"]
    - path: "src/lib/content/obsidian.ts"
      provides: "Wikilink slug resolution and Obsidian-specific helpers"
      exports: ["getAllContentSlugs", "buildPermalinkMap"]
    - path: "content/meta.json"
      provides: "Course structure definition with module order, lesson order, slugs, and titles"
  key_links:
    - from: "src/lib/content/parser.ts"
      to: "src/lib/content/sanitizer.ts"
      via: "import sanitizeHTML"
      pattern: "import.*sanitizeHTML.*from.*sanitizer"
    - from: "src/lib/content/parser.ts"
      to: "src/lib/content/obsidian.ts"
      via: "import getAllContentSlugs for wikilink resolution"
      pattern: "import.*getAllContentSlugs.*from.*obsidian"
---

<objective>
Scaffold the Next.js 15 project, install all dependencies, copy FMAI Knowledge Base content into the project, and build the complete markdown-to-HTML processing pipeline with Obsidian syntax support.

Purpose: Establishes the foundation that all other plans build upon -- the app skeleton and the content pipeline that transforms Obsidian vault markdown into sanitized, syntax-highlighted HTML.

Output: A buildable Next.js 15 app with all content files in content/, a meta.json defining course structure, TypeScript types for the content model, and a working markdown parser that handles wikilinks, GFM, code highlighting, and HTML sanitization.
</objective>

<execution_context>
@/Users/dominicjoseph/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dominicjoseph/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-content-foundation-navigation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 15 project and install all dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.mjs
    tailwind.config.ts
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
    postcss.config.mjs
  </files>
  <action>
Create the Next.js 15 project in the current directory (which already has .planning/ and .git/). Since the directory is not empty, do NOT use `create-next-app` -- instead manually initialize:

1. Create `package.json` with the following dependencies:
   - next@15, react@19, react-dom@19, typescript, @types/react, @types/react-dom, @types/node
   - Content processing: gray-matter, unified, remark-parse, remark-gfm, remark-rehype, rehype-slug, rehype-pretty-code, rehype-stringify
   - Obsidian plugins: @portaljs/remark-wiki-link, remark-obsidian-callout
   - Security: isomorphic-dompurify
   - UI: tailwindcss@4, @tailwindcss/postcss, clsx, lucide-react
   - File utilities: glob

2. Create `tsconfig.json` with Next.js recommended config including path alias `@/*` mapped to `./src/*`.

3. Create `next.config.mjs` -- configure for static export compatibility. Keep it minimal. Mark `isomorphic-dompurify` as server-external if needed to avoid webpack issues (see Pitfall 2 in research).

4. Create `tailwind.config.ts` with content paths pointing to `./src/**/*.{ts,tsx}` and `./src/components/**/*.{ts,tsx}`.

5. Create `src/app/globals.css` with Tailwind directives (`@import "tailwindcss"` for Tailwind v4) plus prose styling for markdown content (overflow-x-auto on pre tags, callout styles).

6. Create `src/app/layout.tsx` as a basic root layout with html lang="en", body with Tailwind classes, Inter font from next/font/google. Include viewport meta tag.

7. Create `src/app/page.tsx` as a placeholder landing page that just says "FMAI Claude Code Academy" with a subtitle.

8. Run `npm install` to install all dependencies.

9. Initialize shadcn/ui: `npx shadcn@latest init` (select default style, use src/ directory, choose slate color scheme). Then add required components: `npx shadcn@latest add sidebar breadcrumb button card separator sheet`. These components will be needed in Plan 03 but installing now avoids conflicting with later work.

10. Verify `npm run build` succeeds with no errors.

IMPORTANT: Use `src/` directory structure (not root-level app/). Tailwind v4 uses `@import "tailwindcss"` NOT `@tailwind base; @tailwind directives`. If Tailwind v4 causes issues, fall back to v3.4 with standard directives.
  </action>
  <verify>
    Run `npm run build` -- must complete with exit code 0.
    Run `npm run dev` and verify http://localhost:3000 shows the placeholder page (curl or visit).
    Verify `src/components/ui/sidebar.tsx` exists (shadcn/ui components installed).
  </verify>
  <done>
    Next.js 15 app builds and runs. All dependencies installed. shadcn/ui components available. Tailwind CSS functional.
  </done>
</task>

<task type="auto">
  <name>Task 2: Copy FMAI Knowledge Base content and create course structure</name>
  <files>
    content/meta.json
    content/architecture/overview.md
    content/agents/index.md
    content/agents/gsd-pipeline.md
    content/agents/specialist.md
    content/agents/dev-config.md
    content/agents/automation-suite.md
    content/agents/design-patterns.md
    content/hooks/hook-reference.md
    content/skills/skills-reference.md
    content/plugins/plugin-reference.md
    content/mcps/mcp-reference.md
    content/config/settings-orchestration.md
    content/config/claude-md-guide.md
    content/config/session-infrastructure.md
    content/config/local-vs-remote.md
    src/lib/content/types.ts
  </files>
  <action>
1. Create the `content/` directory at project root.

2. Copy all markdown files from `~/Documents/FMAI-Knowledge-Base/Internal/CLI Agent Set Up/` into `content/` with a flat module structure using kebab-case slugs. The mapping is:

   Source file -> Destination (moduleId/lessonId.md):
   - `Architecture Overview.md` -> `content/architecture/overview.md`
   - `Agents/_index.md` -> `content/agents/index.md`
   - `Agents/GSD Pipeline Agents.md` -> `content/agents/gsd-pipeline.md`
   - `Agents/Specialist Agents.md` -> `content/agents/specialist.md`
   - `Agents/Dev-Config Agents.md` -> `content/agents/dev-config.md`
   - `Agents/Automation Suite Agents.md` -> `content/agents/automation-suite.md`
   - `Agents/Agent Design Patterns.md` -> `content/agents/design-patterns.md`
   - `Agents/Global Agents - Accessible in any directory..md` -> SKIP (only 4 lines, trivial content)
   - `Hooks/Hook Reference.md` -> `content/hooks/hook-reference.md`
   - `Skills/Skills Reference.md` -> `content/skills/skills-reference.md`
   - `Plug-Ins/Plugin Reference.md` -> `content/plugins/plugin-reference.md`
   - `MCP's/MCP Reference.md` -> `content/mcps/mcp-reference.md`
   - `Other Config/Settings & Orchestration.md` -> `content/config/settings-orchestration.md`
   - `Other Config/CLAUDE.md Guide.md` -> `content/config/claude-md-guide.md`
   - `Other Config/Session Infrastructure.md` -> `content/config/session-infrastructure.md`
   - `Other Config/Local vs Remote Layers.md` -> `content/config/local-vs-remote.md`
   - `_index.md` -> SKIP (this is the vault nav page, not course content)

3. Add YAML frontmatter to EACH copied markdown file. Do NOT modify the markdown body content. Prepend frontmatter block:
   ```yaml
   ---
   title: "Human-readable title"
   description: "One-line summary of what this lesson covers"
   moduleId: "module-slug"
   lessonId: "lesson-slug"
   order: N
   systemVersion: "1.0.0"
   lastVerified: "2026-02-16"
   ---
   ```
   Use the original document's H1 heading as the title. Write a real description based on the content. Order determines lesson sequence within a module.

4. Create `content/meta.json` defining the complete course structure:
   ```json
   {
     "title": "FMAI Claude Code Academy",
     "description": "Interactive training for the FlowMatrix AI Claude Code system",
     "systemVersion": "1.0.0",
     "modules": [
       {
         "id": "architecture",
         "title": "Architecture Overview",
         "description": "System data flow, layer diagram, config relationships",
         "order": 1,
         "lessons": [
           { "id": "overview", "title": "Architecture Overview", "order": 1 }
         ]
       },
       {
         "id": "agents",
         "title": "Agents",
         "description": "22+ agents across 4 suites - GSD Pipeline, Specialist, Dev-Config, Automation",
         "order": 2,
         "lessons": [
           { "id": "index", "title": "Agent Hierarchy Overview", "order": 1 },
           { "id": "gsd-pipeline", "title": "GSD Pipeline Agents", "order": 2 },
           { "id": "specialist", "title": "Specialist Agents", "order": 3 },
           { "id": "dev-config", "title": "Dev-Config Agents", "order": 4 },
           { "id": "automation-suite", "title": "Automation Suite Agents", "order": 5 },
           { "id": "design-patterns", "title": "Agent Design Patterns", "order": 6 }
         ]
       },
       {
         "id": "plugins",
         "title": "Plugins",
         "description": "12 plugins across 3 tiers with commands and use cases",
         "order": 3,
         "lessons": [
           { "id": "plugin-reference", "title": "Plugin Reference", "order": 1 }
         ]
       },
       {
         "id": "hooks",
         "title": "Hooks",
         "description": "7 hooks for session lifecycle and tool-use events",
         "order": 4,
         "lessons": [
           { "id": "hook-reference", "title": "Hook Reference", "order": 1 }
         ]
       },
       {
         "id": "skills",
         "title": "Skills",
         "description": "Custom n8n skills and plugin-provided skills catalog",
         "order": 5,
         "lessons": [
           { "id": "skills-reference", "title": "Skills Reference", "order": 1 }
         ]
       },
       {
         "id": "mcps",
         "title": "MCPs",
         "description": "GitHub and OpenClaw MCP connections and deferred tools",
         "order": 6,
         "lessons": [
           { "id": "mcp-reference", "title": "MCP Reference", "order": 1 }
         ]
       },
       {
         "id": "config",
         "title": "Configuration & Infrastructure",
         "description": "Settings, CLAUDE.md, orchestration, session infrastructure, and deployment layers",
         "order": 7,
         "lessons": [
           { "id": "settings-orchestration", "title": "Settings & Orchestration", "order": 1 },
           { "id": "claude-md-guide", "title": "CLAUDE.md Guide", "order": 2 },
           { "id": "session-infrastructure", "title": "Session Infrastructure", "order": 3 },
           { "id": "local-vs-remote", "title": "Local vs Remote Layers", "order": 4 }
         ]
       }
     ]
   }
   ```

5. Create `src/lib/content/types.ts` with TypeScript interfaces:
   - `LessonMeta` -- frontmatter fields (title, description, moduleId, lessonId, order, systemVersion, lastVerified)
   - `Lesson` -- extends LessonMeta with htmlContent: string, slug: string, previous/next navigation links (or null)
   - `ModuleMeta` -- id, title, description, order, lessons array
   - `CourseStructure` -- title, description, systemVersion, modules array of ModuleMeta
   - `LessonNavLink` -- moduleId, lessonId, title (used for previous/next)

IMPORTANT: When copying content, preserve the original markdown body exactly. Only add frontmatter at the top. Do not reformat or alter the Obsidian syntax in the body -- the parser (Task 3) will handle conversion.
  </action>
  <verify>
    Verify all content files exist: `ls content/*/` should show files in architecture/, agents/, plugins/, hooks/, skills/, mcps/, config/ directories.
    Verify each .md file in content/ starts with `---` (has frontmatter).
    Verify `content/meta.json` is valid JSON: `node -e "require('./content/meta.json')"`.
    Verify `src/lib/content/types.ts` compiles: `npx tsc --noEmit src/lib/content/types.ts`.
  </verify>
  <done>
    16 markdown lessons exist in content/ with proper frontmatter. meta.json defines 7 modules with correct lesson ordering. TypeScript types defined for all content structures.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build markdown-to-HTML parser with Obsidian support and sanitization</name>
  <files>
    src/lib/content/parser.ts
    src/lib/content/sanitizer.ts
    src/lib/content/obsidian.ts
  </files>
  <action>
1. Create `src/lib/content/obsidian.ts`:
   - Export `getAllContentSlugs(baseDir: string): Promise<string[]>` -- scans content/ for all .md files, returns array of kebab-case slugs (filename without extension, lowercased, spaces to hyphens).
   - Export `buildPermalinkMap(baseDir: string): Promise<Record<string, string>>` -- maps Obsidian note names to web route slugs. For example: "Architecture Overview" -> "architecture/overview", "GSD Pipeline Agents" -> "agents/gsd-pipeline", "Hook Reference" -> "hooks/hook-reference". This map resolves wikilinks like `[[Hook Reference]]` to `/modules/hooks/hook-reference`. Must handle the actual wikilinks found in the FMAI content (30+ instances), including:
     - Simple: `[[Architecture Overview]]`
     - With heading anchor: `[[Hook Reference#auto-gsd-workflow.sh]]` -- link to `/modules/hooks/hook-reference#auto-gsd-workflow-sh`
     - With alias: `[[CLAUDE.md Guide|Git Worktree Protocol]]` -- display text "Git Worktree Protocol", link to `/modules/config/claude-md-guide`
   - The permalink map should be built from meta.json -- read the structure, map each lesson's original Obsidian title to its moduleId/lessonId route.

2. Create `src/lib/content/sanitizer.ts`:
   - Export `sanitizeHTML(htmlString: string): string`
   - Use isomorphic-dompurify with allowed tags for educational content (h1-h6, p, a, ul, ol, li, code, pre, blockquote, strong, em, del, table/thead/tbody/tr/th/td, img, div, span, hr, br, figure, figcaption)
   - Allow attributes: href, id, class, alt, src, title, data-*, aria-*, style (for syntax highlighting)
   - Allow data attributes for rehype-pretty-code
   - This is defense-in-depth -- content is trusted but sanitized anyway (CONT-05)

3. Create `src/lib/content/parser.ts`:
   - Export `parseMarkdown(content: string, options: { contentDir: string }): Promise<string>`
   - Build the unified pipeline:
     a. remarkParse -- parse markdown to AST
     b. remarkGfm -- GitHub Flavored Markdown (tables, strikethrough, task lists)
     c. remarkWikiLink (from @portaljs/remark-wiki-link) -- configure with permalink map from obsidian.ts. Set `hrefTemplate` to generate `/modules/{permalink}` URLs. Set `pathFormat` to handle Obsidian shortest-path matching. Handle heading anchors by converting spaces/dots to hyphens in the hash.
     d. remarkObsidianCallout -- convert `> [!note]` etc. to styled HTML
     e. remarkRehype -- bridge to HTML AST (set `allowDangerousHtml: false`)
     f. rehypeSlug -- add IDs to headings for deep linking
     g. rehypePrettyCode -- syntax highlighting with `theme: 'github-dark'`, `keepBackground: false`
     h. rehypeStringify -- serialize to HTML string
   - After pipeline processing, pass through `sanitizeHTML()` before returning
   - Handle errors gracefully: if parsing fails, return error message HTML rather than crashing

4. Write a quick validation script (can be inline in a test or a small node script) that:
   - Reads one content file (e.g., content/architecture/overview.md)
   - Runs it through parseMarkdown
   - Checks that the output contains `<h1`, `<pre`, `<code` (since that file has code blocks)
   - Checks that wikilinks like `[[Local vs Remote Layers]]` are converted to `<a href="/modules/config/local-vs-remote">`
   - Run this script and confirm output is correct

IMPORTANT: The actual content uses wikilinks but does NOT use Obsidian callouts (`> [!note]` syntax) or embeds (`![[file]]`). Still install the callout plugin for future-proofing, but the critical thing to get right is wikilink resolution with heading anchors and aliases. Test with the real content.

NOTE on @portaljs/remark-wiki-link: If this package has compatibility issues with the unified v11 / remark v15 ESM ecosystem, fall back to a simpler custom remark plugin that does regex replacement of `[[...]]` patterns using the permalink map. The wikilinks in this content follow a simple pattern and a custom solution would be acceptable as a fallback.
  </action>
  <verify>
    Create and run a test script: `node --loader ts-node/esm scripts/test-parser.ts` (or use `npx tsx scripts/test-parser.ts`) that:
    1. Parses content/architecture/overview.md through the pipeline
    2. Confirms output is non-empty HTML string
    3. Confirms `<pre` and `<code` tags exist (syntax highlighting worked)
    4. Confirms wikilinks are converted to anchor tags (not raw `[[...]]` text)
    5. Confirms output does NOT contain `<script` tags (sanitizer working)
    Run `npm run build` to confirm no TypeScript/build errors.
  </verify>
  <done>
    parseMarkdown() converts Obsidian markdown to sanitized HTML. Wikilinks resolve to correct /modules/ routes. Code blocks have syntax highlighting. GFM tables render. HTML is sanitized via DOMPurify. Verified with real FMAI content.
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- content/ directory contains 16 .md files across 7 module directories
- content/meta.json defines all 7 modules with correct lesson counts
- parseMarkdown() produces valid HTML from real content with wikilinks resolved
- sanitizeHTML() strips dangerous tags while preserving educational content markup
</verification>

<success_criteria>
1. Next.js 15 app scaffolded with all Phase 1 dependencies installed
2. All FMAI Knowledge Base content copied into content/ with frontmatter and slugged filenames
3. Course structure defined in meta.json with 7 modules, 16 lessons
4. Markdown parser handles wikilinks, GFM, syntax highlighting, and sanitization
5. Build succeeds, dev server runs, parser verified with real content
</success_criteria>

<output>
After completion, create `.planning/phases/01-content-foundation-navigation/01-01-SUMMARY.md`
</output>
